
        :root {
            /* PALETA APPLE DARK MODE REFINADA */
            --bg-deep: #000000;
            --bg-surface: #1C1C1E;
            --bg-card: #2C2C2E;
            
            /* ACENTOS VIBRANTES */
            --primary: #CCFF00; /* Volt */
            --accent: #FF3B30; /* Red */
            --endurance: #BF5AF2; /* Purple */
            --cool: #64D2FF; /* Cyan */
            --gold: #FFD60A; /* Badges */
            
            --text-main: #FFFFFF;
            --text-sec: #8E8E93;
            
            --font-stack: 'Inter', -apple-system, sans-serif;
            --safe-bottom: env(safe-area-inset-bottom, 20px);
            --safe-top: env(safe-area-inset-top, 20px);
            --radius: 22px;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: var(--font-stack); -webkit-tap-highlight-color: transparent; user-select: none; outline: none; }

        body {
            background-color: var(--bg-deep);
            color: var(--text-main);
            height: 100dvh;
            display: flex; flex-direction: column; overflow: hidden;
            font-size: 16px;
        }

        /* --- VIDEO LAYERS --- */
        #bg-video-container, #workout-video-container {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            overflow: hidden; pointer-events: none; transition: opacity 1s ease;
        }
        #bg-video-container { z-index: 0; }
        #workout-video-container { z-index: 1; opacity: 0; }
        
        video { width: 100%; height: 100%; object-fit: cover; transform: scale(1.05); }
        
        .video-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(to bottom, rgba(0,0,0,0.3) 0%, rgba(0,0,0,0.8) 60%, #000 100%);
            backdrop-filter: blur(2px);
        }
        .workout-video-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: radial-gradient(circle at center, rgba(0,0,0,0.2) 0%, rgba(0,0,0,0.85) 80%);
            backdrop-filter: contrast(1.1) brightness(0.9);
        }

        /* --- AMBIENT GLOW --- */
        .ambient-glow {
            position: absolute; width: 100%; height: 100%; top: 0; left: 0; z-index: -1;
            background: radial-gradient(circle at 50% 40%, #111 0%, #000 80%);
            opacity: 0; transition: opacity 1s ease, background 1.5s ease;
        }
        body.mode-app .ambient-glow { opacity: 1; }
        body.mode-app #bg-video-container { opacity: 0; } 
        body.mode-workout #workout-video-container { opacity: 1; }
        body[data-mood="sprint"] .ambient-glow { background: radial-gradient(circle at 50% 30%, rgba(255, 59, 48, 0.3) 0%, rgba(0,0,0,0) 70%); }
        body[data-mood="climb"] .ambient-glow { background: radial-gradient(circle at 50% 30%, rgba(191, 90, 242, 0.3) 0%, rgba(0,0,0,0) 70%); }

        /* --- PANTALLAS --- */
        .screen {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            display: flex; flex-direction: column;
            opacity: 0; pointer-events: none; z-index: 0; transform: scale(0.96);
            transition: opacity 0.4s ease, transform 0.4s cubic-bezier(0.2, 0.8, 0.2, 1);
            padding-bottom: var(--safe-bottom);
        }
        .screen.active { opacity: 1; pointer-events: all; z-index: 10; transform: scale(1); }
        .screen.scrollable { overflow-y: auto; padding-top: calc(var(--safe-top) + 20px); padding-bottom: 100px; }

        /* --- UI COMPONENTS --- */
        .btn-main {
            width: 100%; background: var(--primary); color: #000; border: none; padding: 22px;
            border-radius: 20px; font-size: 1.1rem; font-weight: 800; text-transform: uppercase; margin-top: 20px;
            box-shadow: 0 0 20px rgba(204, 255, 0, 0.2); transition: transform 0.1s; letter-spacing: 1px;
        }
        .btn-main:active { transform: scale(0.98); }

        .section-title { 
            font-size: 0.75rem; text-transform: uppercase; color: var(--text-sec); 
            margin: 30px 0 10px 0; font-weight: 700; letter-spacing: 1.5px; 
            padding-left: 5px; border-left: 3px solid var(--primary); margin-left: 24px;
        }

        /* --- 0. ONBOARDING --- */
        #onboarding-view { justify-content: flex-end; padding: 40px 30px; z-index: 20; }
        .onb-title { font-size: 3.5rem; font-weight: 900; font-style: italic; line-height: 0.9; letter-spacing: -2px; margin-bottom: 10px; }
        .glass-input {
            width: 100%; background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255, 255, 255, 0.1);
            padding: 18px 20px; border-radius: 16px; color: white; font-size: 1.1rem;
            backdrop-filter: blur(15px); margin-bottom: 15px; font-weight: 600;
        }
        .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }

        /* --- 1. SETUP / HUB --- */
        .top-bar {
            padding: 0 24px; display: flex; justify-content: space-between; align-items: flex-end; margin-bottom: 20px;
        }
        .user-pill {
            background: rgba(255,255,255,0.1); padding: 8px 16px; border-radius: 30px; 
            display: flex; align-items: center; gap: 10px; backdrop-filter: blur(10px);
        }
        .user-ava { width: 24px; height: 24px; background: var(--primary); border-radius: 50%; color:black; display:flex; align-items:center; justify-content:center; font-weight:800; font-size:0.8rem;}
        .xp-track { width: 50px; height: 4px; background: rgba(255,255,255,0.2); border-radius: 2px; overflow: hidden; }
        .xp-fill { height: 100%; background: var(--gold); width: 0%; transition: width 0.5s; }

        /* Weekly Widget */
        .week-widget {
            margin: 0 24px; background: var(--bg-surface); border-radius: var(--radius); padding: 20px;
            border: 1px solid rgba(255,255,255,0.05);
        }
        .week-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .today-info { font-weight: 700; font-size: 1.1rem; color: var(--text-main); }
        .week-grid { display: flex; justify-content: space-between; gap: 4px; }
        .day-col { display: flex; flex-direction: column; align-items: center; gap: 6px; opacity: 0.4; flex: 1; }
        .day-col.active { opacity: 1; transform: scale(1.1); font-weight: bold; }
        .day-dot { width: 8px; height: 8px; border-radius: 50%; background: #333; }
        .day-dot.done { background: var(--primary); box-shadow: 0 0 8px var(--primary); }
        .day-dot.target { background: var(--accent); animation: pulse 2s infinite; }
        @keyframes pulse { 0% {box-shadow: 0 0 0 0 rgba(255,59,48,0.4);} 70% {box-shadow: 0 0 0 6px rgba(0,0,0,0);} 100% {box-shadow: 0 0 0 0 rgba(0,0,0,0);} }

        /* Selector Cards */
        .mode-list { display: flex; flex-direction: column; gap: 12px; padding: 0 24px; }
        .opt-card {
            background: var(--bg-surface); border-radius: var(--radius); padding: 20px; position: relative;
            transition: 0.2s; border: 1px solid transparent;
        }
        .opt-card.active { background: #28282A; border-color: rgba(255,255,255,0.15); }
        .card-head { display: flex; align-items: center; justify-content: space-between; }
        .card-title { font-weight: 700; font-size: 1.1rem; color: #fff; }
        .variant-scroll { display: flex; gap: 10px; overflow-x: auto; margin-top: 15px; padding-bottom: 2px; scrollbar-width: none; }
        .pill { 
            background: rgba(255,255,255,0.08); color: var(--text-sec); padding: 8px 18px; border-radius: 100px; 
            font-size: 0.85rem; font-weight: 600; white-space: nowrap; transition: 0.2s;
        }
        .pill.active { background: var(--text-main); color: #000; box-shadow: 0 2px 10px rgba(0,0,0,0.2); }

        /* Sliders */
        .slider-box { background: var(--bg-surface); padding: 24px; border-radius: var(--radius); margin: 20px 24px; }
        .slider-row { display: flex; justify-content: space-between; margin-bottom: 15px; font-weight: 600; font-size: 0.95rem; }
        input[type=range] { -webkit-appearance: none; width: 100%; background: transparent; }
        input[type=range]::-webkit-slider-runnable-track { width: 100%; height: 6px; border-radius: 3px; background: #333; }
        input[type=range]::-webkit-slider-thumb {
            height: 26px; width: 26px; border-radius: 50%; background: #fff; -webkit-appearance: none; margin-top: -10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.5);
        }

        /* --- 2. WORKOUT HUD (VISUALIZER) --- */
        #workout-view { padding: 0; overflow: hidden; }
        .hud-top {
            position: absolute; top: 0; left: 0; width: 100%; height: 80px; padding: var(--safe-top) 24px 0 24px;
            display: flex; justify-content: space-between; align-items: center; z-index: 20;
            background: linear-gradient(to bottom, rgba(0,0,0,0.8), transparent);
        }

        
        .hud-top .btn-hr{
            background: rgba(255,255,255,0.12);
            border: 1px solid rgba(255,255,255,0.18);
            color: #fff;
            padding: 10px 12px;
            border-radius: 999px;
            font-weight: 900;
            letter-spacing: 0.8px;
            font-size: 0.72rem;
            text-transform: uppercase;
            backdrop-filter: blur(10px);
        }
        .hud-top .btn-hr.connected{
            background: rgba(204,255,0,0.18);
            border-color: rgba(204,255,0,0.35);
            color: var(--primary);
        }
        .metrics-row.metrics-3 { grid-template-columns: 1fr 1fr 1fr; }
#visualizer-container {
            height: 18vh; width: 100%; display: flex; align-items: flex-end; padding: 0 50vw; 
            gap: 5px; overflow-x: hidden; mask-image: linear-gradient(to right, transparent, black 20%, black 80%, transparent);
            -webkit-mask-image: linear-gradient(to right, transparent, black 20%, black 80%, transparent);
            margin-top: 90px; z-index: 5; position: relative;
        }
        .v-bar { 
            flex-shrink: 0; width: 14vw; max-width: 60px; background: rgba(255,255,255,0.15); border-radius: 6px; 
            opacity: 0.3; transition: all 0.4s cubic-bezier(0.2, 0.8, 0.2, 1); 
        }
        .v-bar.active { opacity: 1; transform: scaleY(1.1); background: #fff; box-shadow: 0 0 20px rgba(255,255,255,0.4); }
        .v-bar[data-t="high"] { background: var(--accent); } .v-bar[data-t="mid"] { background: var(--endurance); }

        .ring-container { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; position: relative; z-index: 5; }
        .progress-svg { width: 70vw; height: 70vw; max-width: 280px; max-height: 280px; transform: rotate(-90deg); filter: drop-shadow(0 0 20px rgba(0,0,0,0.5));}
        .ring-bg { fill: none; stroke: rgba(255,255,255,0.1); stroke-width: 8; }
        .ring-fg { fill: none; stroke: var(--primary); stroke-width: 8; stroke-linecap: round; transition: stroke-dashoffset 1s linear; }
        .ring-data { position: absolute; top:50%; left:50%; transform:translate(-50%, -50%); text-align: center; width: 100%; }
        .phase-name { font-size: 1.6rem; font-weight: 900; font-style: italic; text-transform: uppercase; line-height: 1; margin-bottom: 5px; }
        .main-timer { font-size: 4.5rem; font-weight: 800; line-height: 0.9; letter-spacing: -3px; font-variant-numeric: tabular-nums; }
        
        .metrics-row { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; padding: 0 24px; z-index: 5; margin-bottom: 20px; }
        .m-card { background: rgba(20, 20, 20, 0.5); border-radius: 20px; padding: 15px; text-align: center; backdrop-filter: blur(20px); border: 1px solid rgba(255,255,255,0.05); }
        .m-val { font-size: 2rem; font-weight: 800; color: #fff; line-height: 1; }
        .m-lbl { font-size: 0.7rem; color: rgba(255,255,255,0.6); font-weight: 700; margin-top: 5px; text-transform: uppercase; }

        .dock {
            padding: 15px 24px calc(15px + var(--safe-bottom)) 24px; 
            display: grid; grid-template-columns: 1fr 1.2fr 1fr; gap: 15px; z-index: 20;
            background: rgba(10,10,10,0.8); backdrop-filter: blur(20px);
        }
        .btn-dock { height: 60px; border-radius: 18px; border: none; font-weight: 800; color: white; text-transform: uppercase; }
        .btn-stop { background: rgba(255, 59, 48, 0.2); color: var(--accent); }
        .btn-pause { background: rgba(255,255,255,0.15); font-size: 1.2rem; }
        .btn-skip { background: rgba(204, 255, 0, 0.15); color: var(--primary); }

        /* --- 3. HISTORY & PROFILE --- */
        .hist-list { padding: 0 24px; display: flex; flex-direction: column; gap: 12px; }
        .hist-card { background: var(--bg-surface); padding: 15px; border-radius: 18px; display: flex; justify-content: space-between; align-items: center; border-left: 4px solid var(--primary); }
        
        .badges-scroll { display: flex; gap: 15px; overflow-x: auto; padding: 10px 24px; scrollbar-width: none; }
        .badge { min-width: 80px; height: 80px; background: #222; border-radius: 50%; display: flex; flex-direction: column; align-items: center; justify-content: center; opacity: 0.3; border: 2px solid #444; }
        .badge.unlocked { opacity: 1; border-color: var(--gold); background: rgba(255, 214, 10, 0.1); box-shadow: 0 0 15px rgba(255, 214, 10, 0.2); }

        /* --- TAB BAR --- */
        .tab-bar {
            position: fixed; bottom: 25px; left: 50%; transform: translateX(-50%);
            width: 90%; max-width: 400px; height: 70px;
            background: rgba(28, 28, 30, 0.95); backdrop-filter: blur(25px);
            border-radius: 35px; display: flex; justify-content: space-around; align-items: center;
            border: 1px solid rgba(255,255,255,0.15); box-shadow: 0 10px 40px rgba(0,0,0,0.6);
            z-index: 50;
        }
        .tab-btn { background: none; border: none; color: #666; font-size: 1.4rem; width: 60px; display: flex; flex-direction: column; align-items: center; gap: 4px; }
        .tab-btn.active { color: var(--primary); transform: translateY(-3px); }
        .tab-lbl { font-size: 0.6rem; font-weight: 700; letter-spacing: 1px; }

        /* --- ALERTS --- */
        #alert-overlay {
            position: absolute; top:0; left:0; width:100%; height:100%; pointer-events:none;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            background: rgba(0,0,0,0.4); opacity: 0; transition: opacity 0.2s; z-index: 60; backdrop-filter: blur(5px);
        }
        #alert-overlay.show { opacity: 1; }
        .big-num { font-size: 10rem; font-weight: 900; color: var(--primary); line-height: 0.8; animation: pulseNum 0.6s infinite alternate; }
        @keyframes pulseNum { from { transform: scale(1); } to { transform: scale(1.1); } }

    
        .dual-actions { display:flex; gap:12px; }
        .btn-soft {
            flex:1;
            background: rgba(255,255,255,0.08);
            color: #fff;
            border: 1px solid rgba(255,255,255,0.12);
            padding: 16px;
            border-radius: 18px;
            font-weight: 800;
            letter-spacing: 0.5px;
            text-transform: uppercase;
            backdrop-filter: blur(10px);
        }
        .btn-soft:active { transform: scale(0.99); }
        .catalog-filters { margin: 0 24px 14px 24px; }
        .filter-row { display:flex; gap:10px; margin-top:10px; }
        .glass-select {
            flex:1;
            background: rgba(255,255,255,0.06);
            border: 1px solid rgba(255,255,255,0.10);
            color: #fff;
            padding: 12px 12px;
            border-radius: 14px;
            font-weight: 700;
            outline:none;
            appearance:none;
        }
        .catalog-list { margin: 0 24px 24px 24px; display:flex; flex-direction:column; gap:12px; }
        .workout-card {
            background: rgba(255,255,255,0.06);
            border: 1px solid rgba(255,255,255,0.10);
            border-radius: 18px;
            padding: 14px;
            backdrop-filter: blur(10px);
        }
        .workout-title { font-weight: 900; font-size: 1.0rem; }
        .workout-meta { color:#9a9a9a; font-weight:700; font-size:0.85rem; margin-top:4px; }
        .chip-row { display:flex; gap:8px; flex-wrap:wrap; margin-top:10px; }
        .chip {
            background: rgba(204,255,0,0.14);
            border: 1px solid rgba(204,255,0,0.22);
            color: var(--primary);
            font-weight: 900;
            font-size: 0.72rem;
            padding: 6px 10px;
            border-radius: 999px;
        }
        .chip.dim { background: rgba(255,255,255,0.06); border-color: rgba(255,255,255,0.12); color:#ddd; }
        .workout-actions { display:flex; gap:10px; margin-top:12px; }
        .btn-mini {
            flex:1;
            background: rgba(255,255,255,0.06);
            border: 1px solid rgba(255,255,255,0.10);
            color:#fff;
            padding: 12px;
            border-radius: 14px;
            font-weight: 900;
            text-transform: uppercase;
            letter-spacing: 0.6px;
        }
        .btn-mini.primary {
            background: var(--primary);
            color:#000;
            border-color: rgba(204,255,0,0.35);
        }
        /* simple toast */
        #toast {
            position: fixed;
            left: 50%;
            bottom: 92px;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.75);
            border: 1px solid rgba(255,255,255,0.14);
            color:#fff;
            padding: 12px 14px;
            border-radius: 16px;
            backdrop-filter: blur(10px);
            font-weight: 800;
            max-width: min(92vw, 520px);
            z-index: 9999;
            text-align: center;
            opacity: 0;
            pointer-events: none;
            transition: opacity .2s ease, transform .2s ease;
        }
        #toast.show { opacity: 1; transform: translateX(-50%) translateY(-6px); }
    